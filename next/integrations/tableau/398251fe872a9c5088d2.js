(globalThis.webpackChunk_upsetjs_tableau_extension=globalThis.webpackChunk_upsetjs_tableau_extension||[]).push([[65],{5810:(e,t,s)=>{"use strict";s.d(t,{Z:()=>f});var i=s(364),a=s(6791),o=s(2291),n=s(1943),l=s(9687),r=s(1100),d=s(543),h=s(4704);const c=(0,a.zE)({root:{flexGrow:1,overflow:"hidden",display:"flex","& > div":{flexGrow:1}},upset:{position:"absolute"}}),u={chartLabel:"13px",setLabel:"13px"},m=(0,n.Pi)((({width:e,height:t})=>{var s;const a=(0,l.oR)(),o=a.ui.dark?h.aS:h.D1,n=a.selectedElems,d=a.hover?a.hover:0===n.length?void 0:n,m=null!==(s=a.props.color)&&void 0!==s?s:h.lG.color;return i.createElement(r.ZP,Object.assign({id:"u",theme:a.ui.theme,sets:a.sets,combinations:a.combinations,width:e,height:t,fontSizes:u},a.props,{className:c.upset,color:m,hasSelectionColor:(0,h.GW)(m),textColor:o.text,alternatingBackgroundColor:"rgba(0, 0, 0, 0.05)",selectionColor:m,fontFamily:!1,selection:d,onHover:a.setHover,onClick:a.setSelection,setAddons:a.setAddons,combinationAddons:a.combinationAddons,exportButtons:!1}))}));function p({width:e,height:t,targetRef:s}){return i.createElement("div",{ref:s},e>0&&t>0&&i.createElement(i.Suspense,{fallback:"loading"},i.createElement(m,{width:e,height:t})))}const b=(0,n.Pi)((()=>i.createElement("div",{className:c.root},i.createElement(d.ZP,{handleHeight:!0,handleWidth:!0},p)))),g=(0,a.zE)({root:{flexGrow:1,position:"relative",display:"flex",flexDirection:"column",justifyContent:"center"},click:{alignSelf:"center"}}),f=(0,n.Pi)((()=>{const e=(0,l.oR)(),t=(0,i.useCallback)((()=>e.api.openDialog()),[e]);return i.createElement("div",{className:g.root},"loading"===e.state||"ready"===e.state&&i.createElement(b,null),"config"===e.state&&!e.isViewMode&&i.createElement(o.Button,{className:g.click,onClick:t,kind:e.ui.button},"Configure"),"init"===e.state&&i.createElement(o.Spinner,{className:g.click,color:e.ui.theme}))}))},7065:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var i=s(364),a=s(9687),o=s(5810),n=s(1713);const l=Promise.resolve(new n.Z);function r(){return i.createElement(a.g3,{api:l},i.createElement(o.Z,null))}},9687:(e,t,s)=>{"use strict";s.d(t,{g3:()=>m,oR:()=>p});var i=s(2830),a=s(364),o=s(1943),n=s(1259),l=s(4993),r=s(9952),d=s(2164);function h(e,t){const s=t.toLowerCase();return e.columns.find((e=>e.fieldName.toLowerCase()===s))}class c extends l.Z{constructor(e){super(e),this._dataTable=null,this._dataTablePromise=new Promise((()=>null)),this._selectionDataTables=null,this._selectionDataTablesPromise=new Promise((()=>null)),this.hover=null,this.selection=null,this.attributeFields=[],this.state="init",this.isViewMode=!1,this.worksheet="",(0,n.rC)(this)}init(e){super.init(e),this.attributeFields=e.attributeFields,this.isViewMode=e.isViewingMode,this.worksheet=e.worksheet,this.regenerate()}handleUpdates(e){super.handleUpdates(e),e.has("attributeFields")&&(this.attributeFields=this.api.attributeFields),(e.has("dataSource")||e.has("worksheet")||e.has("nameField")||e.has("setFields")||e.has("attributeFields"))&&this.regenerate()}regenerate(){const e=this.api;if(this.worksheet&&e.offSelectionChanged(this.setSelectionDataTables),this.worksheet=e.worksheet,this._dataTable=null,this._selectionDataTables=null,!e.dataSource||!e.nameField||0===e.setFields.length||!e.worksheet)return this.state="config",this._dataTablePromise=Promise.resolve(null),void(this._selectionDataTablesPromise=Promise.resolve([]));this.state="loading",this._dataTablePromise=e.getUnderlyingData(e.worksheet,e.dataSource,[e.nameField,...e.setFields,...e.attributeFields].filter(Boolean)),this._dataTablePromise.then((e=>this.setDataTable(e))),this._selectionDataTablesPromise=e.getSelectedMarks(e.worksheet),this._selectionDataTablesPromise.then((e=>this.setSelectionDataTables(e))),e.onSelectionChanged(e.worksheet,this.setSelectionDataTables)}get elems(){const e=this.dataTable;if(!e)return[];const t=h(e,this.api.nameField);if(!t)return[];const s=this.api.attributeFields,i=s.map((t=>h(e,t))).filter((e=>null!=e)),a=t.index;return e.data.map((e=>{const t=e[a].formattedValue,o={};return i.forEach(((t,i)=>{o[s[i]]=e[t.index].value})),{name:t,attrs:o}}))}get setAddons(){return this.attributeFields.map((e=>(0,r.js)((t=>t.attrs[e]),this.elems,{name:e})))}get combinationAddons(){return this.attributeFields.map((e=>(0,r.js)((t=>t.attrs[e]),this.elems,{name:e,orient:"vertical"})))}get selectedElems(){const e=this.selectionDataTables;if(0===e.length)return[];const t=this.api.nameField,s=e.find((e=>null!=h(e,t)));if(!s)return[];const i=h(s,t).index,a=new Set(s.data.map((e=>e[i].formattedValue)));return this.elems.filter((e=>a.has(e.name)))}get sets(){const e=this.dataTable;if(!e)return[];const t=this.api.setFields.map((t=>h(e,t))).filter((e=>null!=e));if(0===t.length)return[];const s=this.elems;return t.map((t=>(0,d.jM)({name:t.fieldName,elems:s.filter(((s,i)=>function(e){if("boolean"==typeof e)return e;if("number"==typeof e)return 0!==e;const t=String(e).toLowerCase();return"1"===t||"true"===t||"t"===t||"yes"===t}(e.data[i][t.index].value)))})))}get combinations(){return(0,d.Qv)(this.sets,Object.assign({elems:this.elems},this.combinationsOptions))}setDataTable(e){this.state=e?"ready":"config",this._dataTable=e}setSelectionDataTables(e){this._selectionDataTables=e}setHover(e){this.hover=e}setSelection(e){this.selection=e,this.api.setSelectedMarks(this.worksheet,this.api.nameField,e?e.elems.map((e=>e.name)):[])}get dataTable(){if(this._dataTable)return this._dataTable;throw this._dataTablePromise}get selectionDataTables(){if(this._selectionDataTables)return this._selectionDataTables;throw this._selectionDataTablesPromise}}(0,i.gn)([n.LO.ref],c.prototype,"_dataTable",void 0),(0,i.gn)([n.LO.ref],c.prototype,"_dataTablePromise",void 0),(0,i.gn)([n.LO.ref],c.prototype,"_selectionDataTables",void 0),(0,i.gn)([n.LO.ref],c.prototype,"_selectionDataTablesPromise",void 0),(0,i.gn)([n.LO.ref],c.prototype,"hover",void 0),(0,i.gn)([n.LO.ref],c.prototype,"selection",void 0),(0,i.gn)([n.LO],c.prototype,"attributeFields",void 0),(0,i.gn)([n.LO],c.prototype,"state",void 0),(0,i.gn)([n.LO],c.prototype,"isViewMode",void 0),(0,i.gn)([n.Fl],c.prototype,"elems",null),(0,i.gn)([n.Fl],c.prototype,"setAddons",null),(0,i.gn)([n.Fl],c.prototype,"combinationAddons",null),(0,i.gn)([n.Fl],c.prototype,"selectedElems",null),(0,i.gn)([n.Fl],c.prototype,"sets",null),(0,i.gn)([n.Fl],c.prototype,"combinations",null),(0,i.gn)([n.aD],c.prototype,"setDataTable",null),(0,i.gn)([n.aD.bound],c.prototype,"setSelectionDataTables",null),(0,i.gn)([n.aD.bound],c.prototype,"setHover",null),(0,i.gn)([n.aD.bound],c.prototype,"setSelection",null);const u=a.createContext(null),m=({api:e,children:t})=>{const s=(0,o.fv)((()=>new c(e)));return a.createElement(u.Provider,{value:s}," ",t," ")},p=()=>{const e=a.useContext(u);if(!e)throw new Error("useStore must be used within a StoreProvider.");return e}}}]);